<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" > 

<mapper namespace="schedule">
	
	<resultMap type="zeniware.schedule.vo.CalendarVo" id="calendarVo">
		<result property="cldrId" column="CLDR_ID"/>
		<result property="cldrNm" column="CLDR_NM"/>
		<result property="cldrColorVal" column="CLDR_COLOR_VAL"/>
		<result property="compId" column="COMP_ID"/>
		<result property="userId" column="USER_ID"/>
		<result property="closeYn" column="COLSE_YN"/>
		<result property="shreYn" column="SHRE_YN"/>
		<result property="regDate" column="REG_DATE"/>
		<result property="modDate" column="MOD_DATE"/>
	</resultMap>

	<resultMap type="zeniware.schedule.vo.ScheduleVo" id="scheduleVo">
			<result property="schedId" column="SCHED_ID"/>
			<result property="cldrId" column="CLDR_ID"/>
			<result property="schedNm" column="SCHED_NM"/>
			<result property="title" column="TITLE"/>
			<result property="start" column="START"/>
			<result property="end" column="END"/>
			<result property="fstFrmigrId" column="FST_FRMIGR_ID"/>
			<result property="startTm" column="START_TM"/>
			<result property="endTm" column="END_TM"/>
			<result property="apntPlc" column="APNT_PLC"/>
			<result property="memoCont" column="MEMO_CONT"/>
	</resultMap>

	<insert id="insertTest" parameterType="String">
		INSERT INTO MYBATIS_TABLE(title) VALUES(#{value, jdbcType=VARCHAR})
	</insert>
	
	<!-- 캘린더 리스트를 가져온다.  -->
	<select id="getCalendarList" parameterType="map" resultMap="calendarVo">
		SELECT 
			CLDR_ID,
			CLDR_NM,
			CLDR_COLOR_VAL,
			COMP_ID,
			USER_ID,
			COLSE_YN,
			SHRE_YN
		FROM 
			FS_CLDR
		WHERE
			COMP_ID = #{compId, jdbcType=VARCHAR}
			AND USER_ID = #{userId, jdbcType=VARCHAR}
			AND SHRE_YN = #{shreYn, jdbcType=VARCHAR}
		ORDER BY REG_DATE ASC
	</select>
	
	<!-- 캘린더 등록 -->
	<insert id="addCalendar" parameterType="zeniware.schedule.vo.CalendarVo">
		INSERT INTO FS_CLDR
		(
			CLDR_ID,
			CLDR_NM,
			CLDR_COLOR_VAL,
			COMP_ID,
			USER_ID,
			COLSE_YN,
			SHRE_YN,
			REG_DATE,
			MOD_DATE
		)
		VALUES
		(
			#{cldrId, jdbcType=VARCHAR},
			#{cldrNm, jdbcType=VARCHAR},
			#{cldrColorVal, jdbcType=VARCHAR},
			#{compId, jdbcType=VARCHAR},
			#{userId, jdbcType=VARCHAR},
			#{closeYn, jdbcType=VARCHAR},
			#{shreYn, jdbcType=VARCHAR},
			NOW(),
			NOW()
		)
	</insert>
	
	<!-- 캘린더 수정 -->
	<update id="updateCalendar">
		UPDATE FS_CLDR
		SET
			CLDR_NM = #{cldrNm, jdbcType=VARCHAR},
			CLDR_COLOR_VAL = #{cldrColorVal, jdbcType=VARCHAR},
			MOD_DATE = NOW()
		WHERE
			CLDR_ID = #{cldrId, jdbcType=VARCHAR}
			AND COMP_ID = #{compId, jdbcType=VARCHAR}
			AND USER_ID = #{userId, jdbcType=VARCHAR}
	</update>

	<!-- 캘린더 삭제 -->
	<delete id="delCalendar" parameterType="zeniware.schedule.vo.CalendarVo">
		DELETE 
			FROM FS_CLDR
		WHERE 
			CLDR_ID = #{cldrId, jdbcType=VARCHAR}
	</delete>

	<!-- 일정 리스트 -->
	<select id="getScheduleList" parameterType="map" resultMap="scheduleVo">
		SELECT T.*
		FROM (
			SELECT
				SCHED_ID,
				CLDR_ID,
<!-- 				SCHED_NM, -->
				CONCAT(START_YMD,'T', IFNULL(LEFT(START_TM, 2), '00'), ':', IFNULL(RIGHT(START_TM, 2), '00')) AS START,
				CONCAT(END_YMD,'T', IFNULL(LEFT(END_TM, 2), '00'), ':', IFNULL(RIGHT(END_TM, 2), '00')) AS END, 
				SCHED_NM AS TITLE,
				FST_FRMIGR_ID,
				START_TM,
				END_TM,
				APNT_PLC,
				MEMO_CONT
			FROM  
				FS_SCHED
			WHERE 
				START_YMD &gt;= #{startYmd, jdbcType=VARCHAR} AND END_YMD &lt;= #{endYmd, jdbcType=VARCHAR}
			)T
	</select>
	
	<!-- 일정 등록 -->
	<insert id="setScheduleData" parameterType="zeniware.schedule.vo.ScheduleVo">
		INSERT INTO FS_SCHED
		(
			CLDR_ID, 
			SCHED_NM, 
			START_YMD, 
			END_YMD, 
			REG_DATE, 
			MOD_DATE, 
			FST_FRMIGR_ID, 
			LST_MODR_ID, 
			START_TM, 
			END_TM, 
			RPET_YN, 
			RPET_END_YMD, 
			RPET_TYPE, 
			RPET_CYC, 
			APNT_PLC, 
			MEMO_CONT
		)
		VALUES
		(
			#{cldrId, javaType=STRING, jdbcType=VARCHAR},
		 	#{schedNm, jdbcType=VARCHAR},
		 	#{startYmd, jdbcType=VARCHAR},
		 	#{endYmd, jdbcType=VARCHAR},
		 	NOW(),
		 	NOW(),
		 	#{fstFrmigrId, jdbcType=VARCHAR},
		 	#{lstModrId, jdbcType=VARCHAR}, 
			#{startTm, jdbcType=VARCHAR},
			#{endTm, jdbcType=VARCHAR},
			#{rpetYn, jdbcType=VARCHAR},
			#{rpetEndYmd, jdbcType=VARCHAR},
			#{rpetType, jdbcType=VARCHAR},
			#{rpetCyc, jdbcType=NUMERIC},
			#{apntPlc, jdbcType=VARCHAR},
			#{memoCont, jdbcType=VARCHAR}
		)
	</insert>
	
	<!-- 일정 수정화면 데이터 -->
	<select id="scheduleModifyData" parameterType="zeniware.schedule.vo.ScheduleVo" resultMap="scheduleVo">
		SELECT
			SCHED_ID,
			CLDR_ID,
			SCHED_NM,
			START_YMD AS START,
			END_YMD AS END,
			FST_FRMIGR_ID,
			START_TM,
			END_TM,
			APNT_PLC,
			MEMO_CONT
		FROM  
			FS_SCHED
		WHERE 
			CLDR_ID = #{cldrId, jdbcType=VARCHAR}
			AND SCHED_ID =  #{schedId, jdbcType=VARCHAR}
	</select>
	
	<!-- 일정 수정 -->
	<update id="updateScheduleData" parameterType="zeniware.schedule.vo.ScheduleVo">
		UPDATE FS_SCHED
		SET
			CLDR_ID = #{cldrId, jdbcType=VARCHAR},
			SCHED_NM = #{schedNm, jdbcType=VARCHAR},
			START_YMD = #{startYmd, jdbcType=VARCHAR},
			END_YMD = #{endYmd, jdbcType=VARCHAR},
			START_TM =  #{startTm, jdbcType=VARCHAR},
			END_TM = #{endTm, jdbcType=VARCHAR},
			LST_MODR_ID = #{lstModrId, jdbcType=VARCHAR},
			MOD_DATE = NOW(),
			APNT_PLC = #{apntPlc, jdbcType=VARCHAR},
			MEMO_CONT = #{memoCont, jdbcType=VARCHAR}
		WHERE 
			SCHED_ID =  #{schedId, jdbcType=VARCHAR}
	</update>
	
	<!-- 일정 이동 및 시간변경 수정 -->
	<update id="updateDropResizeSchedData" parameterType="zeniware.schedule.vo.ScheduleVo">
		UPDATE FS_SCHED
		SET
			START_YMD = #{startYmd, jdbcType=VARCHAR},
			END_YMD = #{endYmd, jdbcType=VARCHAR},
			START_TM =  #{startTm, jdbcType=VARCHAR},
			END_TM = #{endTm, jdbcType=VARCHAR},
			LST_MODR_ID = #{lstModrId, jdbcType=VARCHAR},
			MOD_DATE = NOW()
		WHERE 
			CLDR_ID = #{cldrId, jdbcType=VARCHAR}
			AND SCHED_ID =  #{schedId, jdbcType=VARCHAR}
	</update>
	
	<!-- 일정 삭제 -->
	<delete id="delScheduleData" parameterType="zeniware.schedule.vo.ScheduleVo">
		DELETE 
			FROM FS_SCHED
		WHERE 
			CLDR_ID = #{cldrId, jdbcType=VARCHAR}
			AND SCHED_ID =  #{schedId, jdbcType=VARCHAR}
			AND FST_FRMIGR_ID = #{fstFrmigrId, jdbcType=VARCHAR}
	</delete>
	

</mapper>